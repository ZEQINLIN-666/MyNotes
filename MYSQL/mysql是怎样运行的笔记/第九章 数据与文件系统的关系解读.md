## 数据库和文件系统的关系

什么是文件系统, 操作系统用来管理磁盘的被称为文件系统

像 InnoDB 、 MyISAM 这样的存储引擎都是把表存储在文件系统上的。当我们想读取数据的时候，这些存储引擎会从文件系统中把数据读出来返回给我们，当我们想写入数据的时候，这些存储引擎会把这些数据又写回文件系统。

## MySQL数据目录

MySQL服务器程序在启动时会到文件系统的某个目录下加载一些文件，之后在运行过程中产生的数据也都会存储到这个目录下的某些文件中，这个目录就称为数据目录.

![img](https://s1.ax1x.com/2020/04/02/GGQ2tK.png)

## 数据库对应文件系统的存储结构

使用`CREATE DATABASE [数据库名]`语句创建一个数据库的时候，在文件系统上实际发生了什么呢？其实很简单，每个数据库都对应数据目录下的一个子目录，或者说对应一个文件夹，我们每当我们新建一个数据库时，MySQL会帮我们做这两件事儿：

> 在数据目录下创建一个和数据库名同名的子目录（或者说是文件夹）。
> 在该与数据库名同名的子目录下创建一个名为db.opt的文件，这个文件中包含了该数据库的各种属性，比方说该数据库的字符集和比较规则是个啥。

## 表对应文件系统的存储结构

我们的数据其实都是以记录的形式插入到表中的，每个表的信息其实可以分为两种：

> 表结构的定义.
> 表中的数据

> 表结构就是该表的名称是啥，表里边有多少列，每个列的数据类型是啥，有啥约束条件和索引，用的是啥字符集和比较规则吧啦吧啦的各种信息，这些信息都体现在了我们的建表语句中了。为了保存这些信息，InnoDB和MyISAM这两种存储引擎都在数据目录下对应的数据库子目录下创建了一个专门用于描述表结构的文件，文件名是这样：`表名.frm`, 这个后缀名为.frm是以二进制格式存储的，我们直接打开会是乱码的

## 表中数据对应文件系统的存储结构

在这个问题上，不同的存储引擎就产生了分歧了，下边我们分别看一下InnoDB和MyISAM是用什么文件来保存表中数据的。

### InnoDB是如何存储表数据的

回顾一下 innodb 的实现原理:

![img](https://s1.ax1x.com/2020/04/02/GGlxPK.png)

为了更好的管理这些页，InnoDB 提供了一个`表空间`或者`文件空间`.

```
系统表空间（system tablespace）
```

> 这个所谓的系统表空间可以对应文件系统上一个或多个实际的文件，默认情况下，InnoDB会在数据目录下创建一个名为`ibdata1`,大小为**12M**的文件，这个文件就是对应的系统表空间在文件系统上的表示。

> 在一个MySQL服务器中，系统表空间只有一份。从 MySQL5.5.7 到 MySQL5.6.6 之间的各个版本中，我们表中的数据都会被默认存储到这个系统表空间。

```
独立表空间(file-per-table tablespace)
```

> 在MySQL5.6.6以及之后的版本中，InnoDB并不会默认的把各个表的数据存储到系统表空间中，而是为每一个表建立一个独立表空间，也就是说我们创建了多少个表，就有多少个独立表空间。使用独立表空间来存储表数据的话，会在该表所属数据库对应的子目录下创建一个表示该独立表空间的文件，文件名和表名相同，只不过添加了一个.ibd的扩展名而已，所以完整的文件名称长这样：
> `表名.ibd`.
> .ibd文件就用来存储表中的数据和索引。

### MyISAM是如何存储表数据的

MyISAM并没有什么所谓的表空间一说，表数据都存放到对应的数据库子目录下分为三个文件:
test.frm
test.MYD
test.MYI
其中test.MYD代表表的数据文件，也就是我们插入的用户记录；test.MYI代表表的索引文件，我们为该表创建的索引都会放到这个文件中。

## 表中视图对应文件系统的存储结构

我们知道MySQL中的视图其实是虚拟的表，也就是某个查询语句的一个别名而已，所以在存储视图的时候是不需要存储真实的数据的，只`需要把它的结构存储起来`就行了。只会存储一个`视图名.frm`的文件

## 文件系统对数据库的影响

因为MySQL的数据都是存在文件系统中的，就不得不受到文件系统的一些制约，这在数据库和表的命名、表的大小和性能方面体现的比较明显，比如下边这些方面：

> 数据库名称和表名称不得超过文件系统所允许的最大长度。
> 特殊字符的问题
> 文件长度受文件系统最大长度限制